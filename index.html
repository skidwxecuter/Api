<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Global Posts</title>
  <style>
    body {
      background: #fff;
      color: #000;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    header {
      background: #cc0000;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      font-size: 16px;
    }
    button {
      background: #cc0000;
      color: #fff;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      margin: 8px 0;
    }
    .post {
      border: 1px solid #ddd;
      padding: 15px;
      margin: 15px 0;
    }
    .post h2 {
      margin: 0 0 10px;
    }
    video, iframe {
      width: 100%;
      height: 300px;
      margin: 10px 0;
    }
    .link {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <header>
    <h1>üì∫ Global Posts</h1>
  </header>

  <section id="create">
    <h2>Create a New Post</h2>
    <input id="postTitle" placeholder="Title (required)">
    <textarea id="postDescription" placeholder="Description (required)" rows="3"></textarea>
    <input id="videoURL" placeholder="Video URL (optional)">
    <p>OR Upload Video File (optional):</p>
    <input type="file" id="videoFile" accept="video/*">
    <button onclick="createPost()">Post</button>
  </section>

  <section>
    <h2>üåç All Posts</h2>
    <div id="posts"></div>
  </section>

  <script>
    let posts = JSON.parse(localStorage.getItem('globalPosts') || '[]');

    function createPost() {
      const title = document.getElementById('postTitle').value.trim();
      const desc = document.getElementById('postDescription').value.trim();
      const url = document.getElementById('videoURL').value.trim();
      const fileInput = document.getElementById('videoFile');
      const file = fileInput.files[0];

      if (!title || !desc) {
        alert('Title and Description are required.');
        return;
      }

      if (url) {
        savePost(title, desc, url);
      } else if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          savePost(title, desc, e.target.result);
        };
        reader.readAsDataURL(file);
      } else {
        savePost(title, desc, '');
      }
    }

    function savePost(title, desc, video) {
      const id = Date.now();
      const newPost = { id, title, desc, video };
      posts.push(newPost);
      localStorage.setItem('globalPosts', JSON.stringify(posts));
      renderPosts();
      clearForm();
    }

    function renderPosts() {
      const postsDiv = document.getElementById('posts');
      postsDiv.innerHTML = '';
      posts.slice().reverse().forEach(p => {
        const postEl = document.createElement('div');
        postEl.className = 'post';
        postEl.innerHTML = `
          <h2>${p.title}</h2>
          <p>${p.desc}</p>
          ${renderVideo(p.video)}
          <p class="link"><a href="#${p.id}">üîó Direct Link</a></p>
        `;
        postsDiv.appendChild(postEl);
      });
    }

    function renderVideo(video) {
      if (!video) return '';
      if (video.startsWith('http')) {
        return `<iframe src="${video}" frameborder="0" allowfullscreen></iframe>`;
      } else {
        return `<video controls src="${video}"></video>`;
      }
    }

    function clearForm() {
      document.getElementById('postTitle').value = '';
      document.getElementById('postDescription').value = '';
      document.getElementById('videoURL').value = '';
      document.getElementById('videoFile').value = '';
    }

    // If URL hash exists, show that post only
    window.addEventListener('load', () => {
      if (window.location.hash) {
        const id = parseInt(window.location.hash.substring(1));
        const found = posts.find(p => p.id === id);
        if (found) {
          const postsDiv = document.getElementById('posts');
          postsDiv.innerHTML = '';
          const postEl = document.createElement('div');
          postEl.className = 'post';
          postEl.innerHTML = `
            <h2>${found.title}</h2>
            <p>${found.desc}</p>
            ${renderVideo(found.video)}
          `;
          postsDiv.appendChild(postEl);
          return;
        }
      }
      renderPosts();
    });
  </script>

</body>
</html>
