<!DOCTYPE html>
<html>
<head>
  <title>Announcement Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
    <h1 class="text-2xl font-bold mb-6">Robux Generator Announcements</h1>
    
    <div class="mb-8 p-4 bg-blue-50 rounded-lg">
      <h2 class="text-xl font-semibold mb-4">Create New Announcement</h2>
      <div class="space-y-4">
        <div>
          <label class="block mb-2">Admin Key</label>
          <input type="password" id="admin-key" class="w-full p-2 border rounded" value="your-secret-key-123">
        </div>
        <div>
          <label class="block mb-2">Title</label>
          <input type="text" id="title" class="w-full p-2 border rounded">
        </div>
        <div>
          <label class="block mb-2">Message</label>
          <textarea id="message" rows="3" class="w-full p-2 border rounded"></textarea>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="urgent" class="mr-2">
          <label>Urgent (red alert)</label>
        </div>
        <button onclick="postAnnouncement()" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
          Post Announcement
        </button>
        <p id="status" class="text-green-600 hidden"></p>
      </div>
    </div>
    
    <div>
      <h2 class="text-xl font-semibold mb-4">Current Announcements</h2>
      <div id="announcements-list" class="space-y-3"></div>
    </div>
  </div>

  <script>
    const API_URL = "https://api-90xm.onrender.com";
    
    // Post new announcement
    async function postAnnouncement() {
      const key = document.getElementById('admin-key').value;
      const title = document.getElementById('title').value;
      const message = document.getElementById('message').value;
      const urgent = document.getElementById('urgent').checked;
      
      try {
        const response = await fetch(`${API_URL}/announcements`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-admin-key': key
          },
          body: JSON.stringify({ title, message, isUrgent: urgent })
        });
        
        if (response.ok) {
          document.getElementById('status').textContent = "Announcement posted successfully!";
          document.getElementById('status').classList.remove('hidden');
          loadAnnouncements();
        } else {
          alert("Error: " + (await response.text()));
        }
      } catch (error) {
        alert("Failed to connect to server");
        console.error(error);
      }
    }
    
    // Load announcements
    async function loadAnnouncements() {
      try {
        const response = await fetch(`${API_URL}/announcements`);
        const announcements = await response.json();
        
        const container = document.getElementById('announcements-list');
        container.innerHTML = announcements.map(ann => `
          <div class="p-3 border rounded-lg ${ann.isUrgent ? 'bg-red-50' : ''}">
            <div class="flex justify-between">
              <strong>${ann.title}</strong>
              <button onclick="deleteAnnouncement(${ann.id})" class="text-red-500 hover:text-red-700">
                Delete
              </button>
            </div>
            <p class="text-sm mt-1">${ann.message}</p>
            <p class="text-xs text-gray-500 mt-1">
              ${new Date(ann.createdAt).toLocaleString()}
              ${ann.isUrgent ? '<span class="urgent-badge">URGENT</span>' : ''}
            </p>
          </div>
        `).join('');
      } catch (error) {
        console.error("Failed to load announcements:", error);
      }
    }
    
    // Delete announcement
    async function deleteAnnouncement(id) {
      if (!confirm("Delete this announcement?")) return;
      
      const key = document.getElementById('admin-key').value;
      
      try {
        const response = await fetch(`${API_URL}/announcements/${id}`, {
          method: 'DELETE',
          headers: { 'x-admin-key': key }
        });
        
        if (response.ok) {
          loadAnnouncements();
        }
      } catch (error) {
        alert("Failed to delete announcement");
      }
    }
    
    // Load announcements on page load
    loadAnnouncements();
  </script>
  
  <style>
    .urgent-badge {
      background: #fee2e2;
      color: #dc2626;
      font-size: 0.75rem;
      padding: 0.1rem 0.5rem;
      border-radius: 9999px;
      margin-left: 0.5rem;
    }
  </style>
</body>
</html>
